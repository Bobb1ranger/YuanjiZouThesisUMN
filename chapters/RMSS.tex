\chapter{Robust Mean Square Stability}
\label{chap:RMSS}
\section{Gist of the chapter}
In control theory, robust control is central to both theory and practice. 
Robust control analysis provides stability guarantees for a controlled system with norm-bounded modeling error, including unmodeled dynamics and real parametric uncertainty, which are unknown yet deterministic~\cite{Zhou1996RobustControl, Doyle1987UncertainSS, Packard1990QuadStab, Gahinet1994LMIHinf,packard_mainloop}.

Networked systems have drawn attention to stochastic systems and processes~\cite{IntroStoc}. In particular, stochastic stability problems arise from real-time uncertainties in the process, such as communication intermittency between subsystems and multiplicative noise. However, existing robustness analysis approaches can't effectively handle those real-time uncertainties arising from stochastic processes. 
To enlarge the scope of robust stability for stochastic processes, the notion of Mean Square (MS) stability is more relevant and has therefore been studied more extensively in recent years~\cite{IntroStoc, Willems1973MSstability, Willems1971FreqMSS, Meansquarenorm}.

Despite these advances, existing mean square stability results typically assume perfect knowledge of the nominal system model, thereby neglecting classical modeling uncertainties. The interaction between deterministic modeling errors and stochastic process uncertainties remains insufficiently understood. In this chapter, we aim to investigate this interplay and develop a unified robustness framework that simultaneously accounts for modeling errors and process stochasticity.

In this chapter, we first recapitulate the classical $\mu$-analysis and the definition of MS norm and MS stability~\cite{Meansquarenorm}. We extend the notion of $\mu$-analysis to include both deterministic modeling error and stochastic process uncertainties. Inspired by the idea of relating performance to robustness, we introduce the robust MS norm to represent the system's MS performance upper bound with the presence of norm-bounded deterministic modeling error. We establish the extended \(\mu<1\) (Robust Mean Square Stable) condition and relate it to the optimally-weighted robust MS norm of the nominal model. We provide a convex optimization method to compute the tight robust MS norm upper bound and further establish a sufficient convex method for evaluating the newly-proposed \(\mu\) in robust MS stability analysis.

We validate our analysis through a classic pendulum-cart robot with a \(\mathcal{H}_\infty\) optimal controller and observe the trade-offs between deterministic modeling error and stochastic process uncertainties.


%Linear time invariant (LTI) system is applicable to describe the mechanism of a variety of real physical systems, for example, network communication, electrical and dynamic systems. Although LTI system can give out the differential equations (Continuous time) or iteration equations (Discrete time) of the dynamics, it can't include any unknown deterministic parameters, commonly regarded as robust stability problems, and any stochastic processes in the system, regarded as the mean square (MS) stability problems. To model these uncertainties, some special block is interconnected with the nominal LTI system. Because of the linear or bi-linear properties of LTI systems, convex optimization act as the most popular method of solving these problems.

%The robust stability problem, which is very classic in control field, has been nicely solved by researchers \cite{UncertainSS}\cite{QuadraticStab}\cite{Zhou1996RobustControl}\cite{LMIforH_infty}\cite{packard_mainloop}. Sufficient and necessary condition for robust stability conditions can be found for structured uncertainty in $\mu$ simple class \cite{Zhou1996RobustControl}\cite{packard_mainloop}. Based on the robust stability results, researchers have further interest on how the robust $\mathcal{H}_2$ performance to be, i.e. the energy transporting properties\cite{Paganini}\cite{LMI_Robust_H2}\cite{Sznaier}\cite{LMIbook}.  However, only sufficient conditions for robust $\mathcal{H}_2$ bound condition has been found.


%
% The ability of bearing stochastic uncertainty, which is usually presented by the maximum allowed variance of the multiplicative noises, is the inner properties of a given LTI system. Like using $\mathcal{H}_2$ norm to denotes the energy transportation ability of LTI systems, MS norm is introduced by former researchers \cite{Meansquarenorm}\cite{IOstochastic} to quantify this ability of LTI systems. 
%
 

\section{Problem Formulation}
\begin{problem}
\begin{figure}[h]
    \centering
    \includegraphics[scale=0.55]{figures/RMSSfigure/RMSS_sysblkdiag.png}
    \caption[The block diagram of a system with both modeling error and stochastic feedback channel]{The construction of the system, where $M$ is the nominal block, $\Delta$ is the deterministic uncertain feedback channel and $\bar{\Delta}$ is the stochastic feedback channel.}
    \label{fig:sysconstr}
\end{figure}
Determine the following dynamical system \(M\), with block diagram shown in Figure~\ref{fig:sysconstr},
\begin{subequations}\label{Discrete_statespace_Mix}
\begin{align}
M\colon x[k+1]& ={A}x[k]+{B_p}p[k]+{B_v}v[k]\\
q[k] &={C_q}x[k] +{D_{qp}}p[k]+{D_{qv}}v[k]\\
y[k] &={C_y}x[k]+{D_{yp}}p[k]+{D_{yv}}v[k]
\end{align}
\end{subequations}
interconnecting with $\forall\; \Delta(\colon q \mapsto p) \in \mathcal{B}_{\bm{\Delta}}^{\mathrm{LTI}}$ and \(\forall\; \bar{\Delta}(\colon y \mapsto v) \in \mathcal{B}_{\bar{\Delta}}^{\mathrm{stoc}}\) is mean square or not. 
Mathematically, determine if the state-covariance matrix \(\E\{x[k]x[k]^\top\}\to \mathbf{0}\) as \(k \to \infty\).
\end{problem}
In this formulation, \(\mathcal{B}_{\bm{\Delta}}^{\mathrm{LTI}}\) represent a class of linear time-invariant uncertainty with bounded \(\mathcal{H}_\infty\) norm, elaborated in subsection~\ref{subsec:mu}.

\section{State-of-the-art robust analysis and performance}

Several approaches have sought to capture the interplay between deterministic and stochastic uncertainties from different directions. \cite{Seiler2003BRLjs} investigated the $\mathcal{H}_\infty$ performance of a stochastic jumping system, which is robust stability of the jumping system by the small gain theorem. \cite{Stab_MJLS_1} and \cite{Stab_MJLS_2} focused on the robust stabilizing controller for such jumping systems. \cite{MixH_2infcontrolforrandomsys} optimized the mixed $\mathcal{H}_2$/$\mathcal{H}_\infty$ performance for random time delay network systems. 
\cite{Seiler2003BRLjs}-\cite{MixH_2infcontrolforrandomsys} focused on the $\mathcal{H}_\infty$ guarantees of random systems. 
\cite{CtrlPackDrop_uncertain} considered the norm-bounded model uncertainty in the random packet drop problem and found a sufficient condition for different controller schemes to ensure stability.






\section{Preliminaries on robustness analysis}




\subsection{Structured singular value in robustness analysis}\label{subsec:mu}
In this chapter, we recapture the basic idea of $\mu$-analysis in robust control. We mainly follow the classical definition and notations from~\cite{packard_mainloop}.
% The definition of $\mu$ for a complex matrix is based on the definition of a prescribed set of block diagonal matrices,

% We are interested in the class of operator with structures that consist of some additional properties $P(\Delta)$ to the unit ball operators, that is
% \begin{equation}\label{eqn:delta_class}
% \begin{split}
% \boldsymbol{\Delta}= &\{\Delta\in\mathcal{L}(l_2):\|\Delta\|\leq 1,\text{ and property } P(\Delta) \text{ holds}\}\\
% \end{split}
% \end{equation}
% $P(\Delta)$ are block-diagonal structure, or dynamic restrictions on some operator blocks (e.g. specifying that they are LTI, or static, or memoryless, etc.). We assume $P(\Delta)$ imposes no norm restrictions. If $\Delta$ satisfies $P(\Delta)$, so does $\gamma\Delta$ for any $\gamma>0$. Namely the set,
% \begin{equation}\label{eqn:delta_class_cone}
% \boldsymbol{C\Delta}= \{\Delta\in\mathcal{L}(l_2):\text{ and property } P(\Delta) \text{ holds}\}
% \end{equation} 
% is a cone generated by $\boldsymbol{\Delta}$.
% \begin{defn}\label{defn:mu_operator}
% The structured singular value of an operator $M$ with respect to a set $\boldsymbol{\Delta}$ which satisfy the above assumptions is,
% $$
% \mu_{\bm{\Delta}}(M) = \frac{1}{\inf\{\|\Delta\|,\Delta\in \bm{C\Delta},I-M\Delta\text{ is singular}\}}
% $$
% when the infimum is defined. Otherwise, $\mu_{\bm{\Delta}}(M)$ is defined to be $0$.
% \end{defn}

% From this general structured singular value for operators, we impose some specific restrictions on both the operator $M$ and $\Delta$. 
% We require $M$ to be a $n$ inputs, $n$ outputs bounded LTI discrete time system, with its transfer function in $RH_\infty$. $\Delta$ belongs to the class $\bm{\Delta}_{TI}$, which is defined as,
% \begin{equation*}
%     \begin{split}
%       \bm{\Delta}_{TI} = &\{\Delta\in\mathcal{L}(l_2):\Delta \text{ is LTI and }\Delta(z)\in\bm{\Delta}_{s,f} \\
%       &\text{ for every }|z|\geq1\};\\
%       \bm{\Delta}_{s,f} = &\{\Delta:\|\Delta\|\leq 1,\Delta=\mathrm{diag}(\delta_1 I_{r_1},\hdots,\delta_L I_{r_L},\Delta_{L+1},\hdots,\Delta_{L+F})\\
%         &,\delta_i \in \mathbb{C},\Delta_{L+j}\in \mathbb{C}^{m_j\times m_j}\};\ \sum_i r_i+\sum_j m_j =n
%     \end{split}
% \end{equation*}
% Now based on the specification on $M$ and $\Delta$, definition (\ref{defn:mu_operator}) gives the $\mu_{\bm{\Delta}_{TI}}(M)$.
% \cite{dullerud2013course} proposes a theorem that converts the wellpose-ness of $(M,\bm{\Delta}_{TI})$ to a pure matrix test in frequency domain. We present its discrete time version in theorem (\ref{}).
% \begin{thm}
% Assume M is a time invariant bounded operator, with its transfer function in $RH_\infty$. The following are equivalent:

% (a) $(M,\bm{\Delta}_{TI})$ is robustly well connected.

% (b) $\mu_{\bm{\Delta}_{TI}}(M)<1$.

% (c) $\sup_{\omega\in[0,2\pi]}\mu_{\bm{\Delta}_{s,f}}(M(e^{i\omega}))<1$

% And furthermore, $\mu_{\bm{\Delta}_{TI}}(M) =\sup_{\omega\in[0,2\pi]}\mu_{\bm{\Delta}_{s,f}}(M(e^{i\omega}))$.
% \end{thm}

% \begin{defn}
% For $M\in\mathbb{C}^{n\times n}$, $\mu_{\boldsymbol{\Delta}}(M)$  is defined as

% $$
% \mu_{\boldsymbol{\Delta}}(M) := \frac{1}{\min\{\bar{\sigma}(\Delta),\det(I-M\Delta)=0,\Delta\in \boldsymbol{\Delta}\}};
% $$
% unless no $\Delta\in \boldsymbol{\Delta}$ makes $(I-M\Delta)$ singular, in which case $\mu_{\boldsymbol{\Delta}}(M)=0$.
% \end{defn}

\begin{figure}[h]
    \centering
    \includegraphics[scale=0.6]{figures/RMSSfigure/RS_intercon.png}
    \caption{Interconnection of nominal model $M$ and model uncertainty $\Delta$}
    \label{fig:interconnection}
\end{figure}
\begin{defn}
Given a stable MIMO system, $M\in {\cal RH}_\infty^{n\times n}$, we define 
$$\mu_{\bm{\Delta}}(M)=
\sup_{\omega\in[0,2\pi]}\frac{1}{\displaystyle\min_{\Delta\in \bm{\Delta}_{\mathrm{LTI}}}\{\bar{\sigma}(\Delta(e^{j\omega})),\det(I-M\Delta)(e^{j\omega})=0\}}
$$
where \(\bm{\Delta}_{LTI}\) is a class of LTI uncertainties structured with several repeated scalars and full blocks. Two non-negative integers, \(L\) and \(F\), denote the number of repeated scalar blocks and the number of full blocks, respectively~\cite{packard_mainloop}.
\begin{equation}\label{eqn:delta_structure}
\begin{split}
\bm{\Delta}_{\mathrm{LTI}} \coloneqq &\{\Delta:\Delta=\mathrm{diag}(\delta_1 I_{r_1},\hdots,\delta_L I_{r_L},\Delta_{L+1},\hdots,\Delta_{L+F}),\\
&\delta_i \in {\cal RH}_{\infty},\Delta_{L+j}\in{\cal RH}_{\infty}^{m_j\times m_j}\};\ \sum_i r_i+\sum_j m_j =n
\end{split}
\end{equation}
In addition, we will frequently consider norm-bounded subsets of $\bm{\Delta}$. 
In particular, we define
\begin{equation*}
    \mathcal{B}_\Delta^{\mathrm{LTI}}
    \coloneqq 
    \bm{\Delta} \cap 
    \left\{ \Delta \,\middle|\, 
    \|\Delta\|_{\mathcal{H}_\infty} \le 1 
    \right\},
\end{equation*}
which denotes the subset of $\bm{\Delta}$ consisting of LTI operators with $\mathcal{H}_\infty$ norm not exceeding one.
\end{defn}

\begin{proposition}
The closed loop system in Figure~\ref{fig:interconnection} is well-posed and internally stable for all $\Delta\in\mathcal{B}_\Delta^{\mathrm{LTI}}$ iff $\mu_{\bm{\Delta}}(M)<1$. 
\end{proposition}


\begin{defn}
A class of structure $\bm{\Delta}_{\mathrm{LTI}}$ is said to be $\mu$-simple if $2L+F\leq 2$.
\end{defn}
The following result provides a method to compute \(\mu_{\bm{\Delta}}(M)\) given an arbitrary $\mu$-simple \(\bm{\Delta}\) structure.
\begin{thm}\label{thm:musimple}
If $\bm{\Delta}_{\mathrm{LTI}}$ is $\mu$-simple, \(\mu_{\bm{\Delta}}(M)\) can be found by solving the following optimization:
\[
\mu_{\bm{\Delta}}(M) = \inf_{D\in \mathcal{D}}\bar{\sigma}(D^{\frac{1}{2}}MD^{-\frac{1}{2}}),
\]
where \(\mathcal{D}\) is the set of square matrices that commute with any generic element in \(\bm{\Delta}\), 
\begin{equation*}
    \mathcal{D} \coloneqq \{\mathrm{diag}(D_1,\hdots,D_L,d_1 I_{m_1},\hdots,d_F I_{m_F}),\;
    D_i \in \mathbb{S}^{r_i}, d_j>0\}.
\end{equation*}
Otherwise, the above optimization problem finds an upper bound for \(\mu_{\bm{\Delta}}(M)\).   
\end{thm}


% Consider a complex matrix P with partition:
% $$
% P =\left[\begin{array}{cc}
%     P_{11} & P_{12}  \\
%     P_{21} & P_{22}
% \end{array}\right]
% $$
% $\Delta_1$ is compatible with $P_{11}$, and $\Delta_2$ is compatible with $P_{22}$.




\subsection{Robust control view of MS stability}

In this section, we briefly review some results on mean-square stability, first presented in \cite{Meansquarenorm}. For the related CT result, see \cite{Vaidya2018CtMSS}.
In particular, IID random variables can be interpreted as stochastic uncertainty in the familiar robust control framework. We consider systems in DT.

\begin{figure}[h]\label{fig:sysconstr_elia}
    \centering
        \includegraphics[scale = 0.6]{figures/RMSSfigure/MSS_intercon.png}
        \caption[LTI plant interconnected with stochastic gain channels]{The system is constructed with a nominal plant and a stochastic gain feedback between inputs and outputs. $\bar{\Delta}$ denotes the gain block, defined in following}
\end{figure}

\cite{Meansquarenorm} considered the following state-space model of an LTI system with stochastic interconnection between output $y$ and input $v$
\begin{equation}\label{eqn:DT_statespace}
G: {x^+}={A}x+{B}{v};\ {y}={C}x+D v.
\end{equation}




Then transfer matrix mapping $v$ to $y$ is hence
$G(z)=C(zI-A)^{-1}B+D$, a $n_y\times n_v$ ($n_y$ is required to be equal to $n_v$) transfer function matrix. And define the mean square norm:
\begin{defn}\label{defn:MSnorm}
The MS norm of $p\times p$ transfer function matrix $G=[G_{ij}]$ ($G_{ij}$ are proper transfer functions.) is defined as 
$$
\|G\|_{MS} \doteq \max_{i=1,\hdots,p}\sqrt{\sum_{j=1}^p{\|G_{ij}\|_2^2}}  
$$


\end{defn}
Note that for a given explicit transfer matrix, MS norm gives the maximum among the output channels while the traditional $\mathcal{H}_2$ norm gives the sum energies of the output channels.
\cite{Meansquarenorm} also gives out the definition, based on the state-space realization in \ref{eqn:DT_statespace}, for the MS closed-loop stability. Interconnect the output $y$ with input $v$, $v=\bar{\Delta}y$, with the stochastic uncertainty $\bar{\Delta}$ satisfies the following assumptions
\begin{ass}\label{asp:MSS_stocDelta}
$\bar{\Delta}$ is a diagonal multiplicative operator. Mathematically, $\bar{\Delta}=\mathrm{diag}(\delta_{s_i},i=1,...,n_v)$. $v=\bar{\Delta}y \Leftrightarrow v_i=\delta_{s_i} y_i$ for each \(i=1,\hdots,n_v\).
\begin{enumerate}
    \item $\delta_{s_i}[k]$ and $\delta_{s_j}[k]$ are independent for $i\neq j$.
    \item $\delta_{s_i}[k]$ are I.I.D. in time, and independent of the system process \(x[0\colon t]\) for any \(t\in \mathbb{N}\).
    \item $\E\{\delta_{s_i}[k]\}=0$ in each channel.
    \item $var(\delta_{s_i}[k])=\sigma^2$ in each channel.    
\end{enumerate}
We denote the set of stochastic uncertainty above with $\sigma^2\leq 1$ as 
${\cal B}_{\bar{\Delta}}^{\mathrm{stoc}}$.
\end{ass}


\begin{defn}
The system defined in \ref{eqn:DT_statespace} interconnected by $v=\bar{\Delta}y$ is said to be MS stable if $M[k] \coloneqq \E\{x[k]x[k]^T\},\forall k \in \mathbb{N}$ is well defined, and $\lim_{k\to\infty}M[k]=\mathbf{0}$.
\end{defn}
\begin{rem}
The covariance-like matrix \(M[k]\) will converge to zero because there is no additive noise in the dynamics by the system in~\eqref{eqn:DT_statespace}.   
\end{rem}
Based on the definition of the MS stability, \cite{Meansquarenorm} further defines the MS structured norm.
\begin{defn}\label{defn:muMS}
    The MS structured norm of a system $G$ with stochastic interconnection $\bar{\Delta}$, denoted by $\mu_{MS}(G,\bar{\Delta})$ is defined as
    \begin{equation*}
        \mu_{MS}(G,\bar{\Delta})=\frac{1}{\sup\{\sigma^2:\text{the closed loop system is MS stable}\}}
    \end{equation*}
\end{defn}
% {\color{red} 
% Should we change the def as follows
%     \begin{equation*}
%         \mu_{MS}(G,\bar{\Delta})=\frac{1}{\inf\{\sigma^2:\text{the closed loop system is not MS stable}\}}
%     \end{equation*}}
This definition also implies that $\frac{1}{\mu_{MS}}$ is the maximal variance the system can tolerate in the stochastic feedback channel. 
For simplicity, Assumption~\ref{asp:MSS_plant} is made to ensure the plant is stable by itself and its interconnection with \(\bar{\Delta}\) is always well-posed. \cite{Meansquarenorm} further provides the following core theorem on $\mu_{MS}$.
\begin{ass}\label{asp:MSS_plant}
$G$ is Schur stable, i.e. $\rho(A)<1$, and \(D\) is either strictly upper or lower triangular.
\end{ass}

\begin{thm}\label{thm:MSS}
Under Assumption~\ref{asp:MSS_plant} and \ref{asp:MSS_stocDelta}, the following statements are equivalent:
\begin{enumerate}
    \item The feedback interconnection of $G$ and $\bar{\Delta}$ is MS stable.
    \item There exist a positive definite matrix $Q$ and positive vector $\alpha\in \mathbb{R}^p$such that 
    \begin{equation*}
    \begin{split}
        Q&>A Q A^T+\sum_{j=1}^p B_j \alpha_j B_j^T\\
        \alpha_i&> \sigma^2(C_i Q C_i^T+\sum_{j=1}^p D_{ij}\alpha_j D_{ij}^T),\ for\ i=1,\hdots,p
    \end{split}
    \end{equation*}
    \item $\sigma^2 \inf_{\theta>0,\mathrm{diag}}\|\theta G \theta^{-1}\|_{MS}^2<1$
    \item $\sigma^2\rho(\tilde{G})<1$, where
    \begin{equation}   
    \tilde{G} \doteq
    \left[
    \begin{array}{ccc}
        \|G_{11}\|_2^2 & \ldots & \|G_{1 n_v}\|_2^2\\
        \vdots & \ddots &\vdots\\
        \|G_{{n_y}1}\|_2^2 & \ldots & \|G_{{n_y}{n_v}}\|_2^2
    \end{array}
    \right]
    \end{equation}
\end{enumerate}
\end{thm}

Corollary~\ref{cor:muMScompute} follows immediately,
\begin{corollary}\label{cor:muMScompute}
\begin{equation}
\mu_{MS}=\rho(\tilde{G})=\inf_{\theta>0,\mathrm{diag}}\|\theta G \theta^{-1}\|_{MS}^2
    =\inf_{\theta>0,\mathrm{diag}} \max_{i}\sum_{j}\|\theta_{i}G_{ij}\theta_j^{-1}\|_2^2
\end{equation}
\end{corollary}


% And the MS stability is defined as: $\lim_{k \rightarrow \infty}\E(x(k)x(k)^T)$ for following system.


The above results show that the condition for MS stability in the presence of I.I.D. stochastic uncertainty has several similarities with other robust stability results. The spectral radius condition, in terms of the $\ell_1$ norms instead of the ${\cal H}_2$ norm squared,  is necessary and sufficient for the robust stability w.r.t. model uncertainty of bounded  $\ell_\infty$ induced norm \cite{Khammash1990Robustl1}. 

The minimization over constant $\theta$ weight, with the ${\cal H}_\infty$ norm instead of the $MS$ norm,  appears in the robust stability condition when the model uncertainty is nonlinear or time varying with bounded $\ell_2$ induced norm \cite{Shamma1994RS}. 
% {\color{red}\cite{ need refs} }




\section{Main results}
In this section, we generalize the preliminary result from~\cite{Meansquarenorm} to the case where the plant model is subject to LTI-structured uncertainty. We next present the formulation and solution of new robust mean square performance and stability problems.

\subsection{{Robust Mean Square norm}}
% {\color{red} I would expect a generalized notion of mu we have discussed and derived in the past} 
% \sout{We further add a square deterministic block to this system.For the robust structured MS norm, we'd like to find the largest $\sigma^2$ for the stochastic feedback $\bar{\Delta}$, which ensures quadratic stability whenever a deterministic uncertainty varying in the unit ball. To clarify, we realize the problem in following state-space:}






% {\color{red} Do we need assumptions that guarantee our definition is correct?. Does this  means that the system must be detectable and stabilizable by input/output of the delta stochastic.? Maybe this matter in next section?}




For each class of $\mathcal{B}_\Delta$, there is a class of corresponding multipliers which commute with $\Delta$:
$$
{\bf{\Lambda}} =\{\Lambda \vert\; \Lambda=\mathrm{diag}[\Lambda_1,\hdots,\Lambda_L,\lambda_{L+1} I_{m_1},\hdots,\lambda_{L+F} I_{m_F}] \}
$$

We denote by $G_\Delta \coloneqq \mathcal{F}_u(M, \Delta)$ the upper linear fractional interconnection of $M$ and $\Delta$. Adapted from Definition~\ref{defn:MSnorm}, we define the Robust MS-norm problem as follows:
\begin{defn}\label{robust_MS.def}
Given a nominal plant $M$ defined as \ref{Discrete_statespace_Mix}. If $G_\Delta$ is well defined and robustly stable for $\Delta\in\mathcal{B}_\Delta^{LTI}$,  then the system $M$ is said to have robust mean square norm $\|G\|_{MS,r}$ if 
\begin{equation*}
    \|G\|_{MS,r} \doteq \sup_{\Delta \in \mathcal{B}_\Delta^{LTI}}\max_{i \in \{1,\hdots,n_y\}}\sqrt{\sum_{j=1}^{n_v}{\|G_{\Delta,ij}\|_2^2}} < \infty
\end{equation*}
\end{defn}

% And we denote by $M_0$ the lower fractional interconnection of $M$ and $\mathbf{0}$ matrix, i.e. $M_0 =S(M,\mathbf{0}_{n_v \times n_v})$. $M_0$ has state-space realization of:


% $$
% M_0:\left[\begin{array}{c;{2pt/2pt}c}
%     A & B_p\\ \hdashline[2pt/2pt]
%     C_q & D_{qp}
% \end{array}\right]
% $$

% It's clear that $M_0$ is the mean system.




Note here, because of the interchanging properties of $\sup$ and $\max$ and the monotonicity of the square root, we have 
\begin{equation*}
    \|G\|_{MS,r}^2=\max_{i=1,\hdots,p}\sup_{\Delta \in \mathcal{B}_\Delta^{LTI}}\sum_{j=1}^p{\|G_{\Delta,ij}\|_2^2}
\end{equation*}
which means the robust $MS$ norm square is just the maximum of robust $\mathcal{H}_2$ norm of each output channel. We can thereby solve the robust MS norm through convex optimization.
We begin with the transfer function between the input and output (obtained from the minimal state-space realization):

\begin{equation}\label{freq_domain_mapping}
\left[
    \begin{array}{c}
        {q}\\
        {y} 
    \end{array}\right]
=
{M}(z)
\left[
    \begin{array}{c}
        {p}\\
        {v} 
    \end{array}\right]
=
\left[
\begin{array}{cc}
    M_{qp}&M_{qv}\\
    M_{yp}&M_{yv}\\
\end{array}\right]
\left[
\begin{array}{c}
    {p}\\
    {v} 
\end{array}\right]
\end{equation}
where 
\begin{equation}\label{eqn:constrM}
\left[
\begin{array}{cc}
    M_{qp}&M_{qv}\\
    M_{yp}&M_{yv}\\
\end{array}\right] \coloneqq 
\left[
\begin{array}{cc}
    {C_q}(z{I}-{A})^{-1}{B_p}+D_{qp}&{C_q}(z{I}-{A})^{-1}{B_v}+{D_{qv}}\\
    {C_y}(z{I}-{A})^{-1}{B_p}+{D_{yp}}&{C_y}(z{I}-{A})^{-1}{B_v}+D_{yv}\\
\end{array}\right]\\
\end{equation}
We next construct a bunch of single-output transfer functions \(M_i(z)\) from $M(z)$.
Let 
\begin{equation}\label{constrM_i}
M_i(z)=
\left[
    \begin{array}{cc}
        M_{qp}&M_{qv}\\
        M_{yp_i}&M_{yv_i}\\
    \end{array}\right]
\end{equation}

The following result is about robust ${\cal H}_2$-norm specifically for single-output systems.
\begin{lemma}\label{MISOH_2}\cite{Sznaier1999RobustH2}
Given a MISO system with input $v\in \mathbb{R}^{n_v}$ and scalar output \(y\in\mathbb{R}\). If there exist a positive definite Hermitian matrix $X(\omega)\in \mathbb{X}$ and a real transfer function $y(\omega)>0$ such that
\begin{equation}\label{freqbound}
    [M(e^{j\omega})]^\hermconj \left[
\begin{array}{cc}
    X(\omega) &  \\
     & 1
\end{array}\right]M(e^{j\omega})<\left[
\begin{array}{cc}
    X(\omega) &  \\
     & y(\omega)I_{n_v}
\end{array}\right]
\end{equation} holds for all $\omega\in[0,2\pi)$ and,
\begin{equation}\label{intbyfreq}
    \int_0^{2\pi}y(\omega)\frac{d\omega}{2\pi}<\gamma^2    
\end{equation}
Then the robust $\mathcal{H}_2$ norm of the uncertain system is bounded by $\gamma$.

\end{lemma}
The condition is necessary and sufficient when the structure of the deterministic uncertainty $\Delta$ is $\mu$-simple, i.e. $2L+F\leq2$. While extending the result to robust ${\cal H}_2$-norm of MIMO systems can be conservative (see [9] Theorem 3), it turns out that the extension to MIMO robust MS-norm is direct. 
This is our main result of this section. 
\begin{thm}\label{thm:robMSnorm}
Nominal System $M$ has Robust MS Norm performance $<\gamma$ if there exist 
positive definite Hermitian matrices $X_i(\omega)\in \mathbb{X}$ and real transfer function $y_i(\omega)>0$
$i=1,\hdots,n_v$ such that 
\begin{equation}\label{eqn:freqbound_2}
    [M_i(e^{j\omega})]^\hermconj\left[
\begin{array}{cc}
    X_i(\omega) &  \\
     & 1
\end{array}\right]M_i(e^{j\omega})<\left[
\begin{array}{cc}
    X_i(\omega) &  \\
     & y_i(\omega)I_{n_v}
\end{array}\right]
\end{equation} holds for all $\omega\in[0,2\pi)$ and,
\begin{equation}\label{eqn:intbyfreq_2}
    \int_0^{2\pi}y_i(\omega)\frac{d\omega}{2\pi}<\gamma^2.
\end{equation}
The condition is necessary and sufficient when the structure of the deterministic uncertainty $\Delta$ is $\mu$ simple, which is satisfying $2L+F\leq2$.
\end{thm}


\begin{proof}
Proof of Sufficiency:
Assume there are $X_i(\omega),y_i(\omega),\; \forall i\in\{1,\hdots,n_v\}$ satisfying the collection of LMIs in~\eqref{eqn:freqbound_2} and \eqref{eqn:intbyfreq_2}.
Then, for each MISO sub-system with input $v$ and output $y_i$, apply Lemma~\ref{MISOH_2}; each of the systems has robust $H_2$ performance less than $\gamma$. According to the definition of MS norm of a MIMO system to be the largest $H_2$ norm of all its output channels, the robust MS norm performance of system $M$ is less than $\gamma$.

Proof of Necessity (Assuming the structure of the deterministic uncertainty to be $\mu$-simple):
From the definition of MS norm, each output channel has a robust $H_2$ norm less than $\gamma$ when the robust MS norm of system $M$ is less than $\gamma$.
% (Otherwise, we can pick the $\Delta$ which makes one of the output channel have $H_2$ norm more than $\gamma$. Then the robust MS norm of $M$ is more than $\gamma$).

Because Lemma~\ref{MISOH_2} is sufficient and necessary when $\Delta$ is $\mu$-simple. We can always find a pair of $X$ and $y$ which satisfy the LMIs \eqref{eqn:freqbound_2} and \eqref{eqn:intbyfreq_2} if one MISO system has robust $H_2$ performance less than $\gamma$, .
Therefore, for each output channel, there exists such a pair of functions of frequency $X_i(\omega)$ and $y_i(\omega)$. 
\end{proof}
% The proof is based on applying Lemma \ref{MISOH_2} on each output $y_i$.  
% In principle, we should only allow one same perturbation $\Delta$ for each of the $M_i$'s. However, given that our performance measure is the max 2-norm  of each $M_i$ and that $\Delta$ sees the same transfer function matrix for each $i$, there is no conservatism induced by searching over worst case $\Delta_i$ for each subsystem $i$. 




\subsection{Robust MS stability}
\begin{defn}
Let $G_\Delta=\mathcal{F}_u(M,\Delta)$ be the upper LFT of $M$ and $\Delta$, Define 
$$
\mu_{\bm{\Delta},\bar{\Delta}} (M)= 
\left\{
\begin{array}{c}
    \mu_{\bm{\Delta}}(M_{qp}), \text{ if }\mu_{\bm{\Delta}}(M_{qp})\geq1\\
    \max\{\mu_{\bm{\Delta}}(M_{qp}),\sup_{\Delta\in\mathcal{B}_\Delta^{\mathrm{LTI}}}\mu_{MS}(G_{\Delta})\},\text{else}
\end{array}
\right.
$$

\end{defn}

\begin{thm}
$\mu_{\bm{\Delta},\bar{\Delta}} (M)<1$ if and only if the $\mathcal{F}_u(M,\Delta)$ is well defined and robustly stable and $\mathcal{F}_l(\mathcal{F}_u(M,\Delta),\bar{\Delta})$ is MS stable for all $\Delta\in\mathcal{B}_\Delta^{\mathrm{LTI}}$ and all $\bar{\Delta}$ with $\sigma^2\leq1$.
\end{thm}
\begin{proof}
Proof of sufficiency: 
If $\mu_{\bm{\Delta},\bar{\Delta}} (M)<1$, then $\mu_{\bm{\Delta}}(M_{qp})<1$ and $\sup_{\Delta\in\mathcal{B}_\Delta^{\mathrm{LTI}}}\mu_{MS}(G_{\Delta})<1$. So $S(\Delta,M)$ is well defined and robustly stable for all $\Delta\in\mathcal{B}_\Delta^{\mathrm{LTI}}$. And for all $\Delta\in\mathcal{B}_\Delta^{\mathrm{LTI}}$, the system $\mu_{MS}(G_\Delta)<1$, which means $S(\Delta,M)$ is MS stable for all $\bar{\Delta}$ with variance $\sigma^2\leq1$.

Proof of necessity: If $\mu_{\bm{\Delta},\bar{\Delta}} (M)\geq1$, then $\mu_{\bm{\Delta}}(M_{qp})\geq1$ or $\mu_{\bm{\Delta}}(M_{qp})<1$ and $\sup_{\Delta\in\mathcal{B}_\Delta^{\mathrm{LTI}}}\mu_{MS}(G_{\Delta})\geq1$. If $\mu_{\bm{\Delta}}(M_{qp})\geq1$, then $S(\Delta,M)$ is not well defined or unstable for some $\Delta\in\mathcal{B}_\Delta^{\mathrm{LTI}}$. Otherwise, $\sup_{\Delta\in\mathcal{B}_\Delta^{\mathrm{LTI}}}\mu_{MS}(G_{\Delta})\geq1$. Note $G_{\Delta}$ is well defined and stable for all $\Delta\in\mathcal{B}_\Delta^{\mathrm{LTI}}$ in this case. Then for some ${\Delta}\in\mathcal{B}_\Delta^{\mathrm{LTI}}$, there exist $\bar{\Delta}$ with variance $\sigma^2\leq1$, which makes $G_\Delta$ MS unstable.
\end{proof}

Given the significance of MS-norm in the MS stability condition of Corollary~\ref{cor:muMScompute}, in this section, we consider the problem of robust MS stability. In analogy with the main loop theorem in \cite{packard_mainloop}, we have the following definition,
\begin{defn}\label{robust_specr.def}
Given a nominal system $M$ defined as \ref{Discrete_statespace_Mix}. If $G_\Delta=S(\Delta,M)$ is well defined and robustly stable for $\Delta\in\mathcal{B}_\Delta^{\mathrm{LTI}}$, then the system \(M\) is said to have robust mean square stability if 
\begin{equation*}
    \rho_{r}(\tilde{G})\doteq \sup_{\Delta \in \mathcal{B}_\Delta^{LTI}}\rho(\tilde{G}_{\Delta}) < 1
\end{equation*}
\end{defn}
% Note is $M$ has robust spectral radius $\rho(\tilde{G})_r\geq 1 $ iff the feedback interconnection of $M$ with 
% $\Delta_{mix}=\left[\begin{array}{cc}\Delta&\\& \bar{\Delta}\end{array}\right]$ is  MS stable for all $\Delta\in \mathcal{B}_\Delta^{LTI}$ and $\bar{\Delta}\in {\cal B}_{\bar{\Delta}}^{stoc}$. 

Applying Corollary~\ref{cor:muMScompute}, $\rho_r(\tilde{G})=\sup_{\Delta\in\mathcal{B}_\Delta^{\mathrm{LTI}}}\inf_{\theta>0}\|\theta G_\Delta\theta^{-1}\|^2_{MS}<1$. The exact value of $\rho_r(\tilde{G})$ does not appear to be a simple task at the moment. 

% \begin{prop}
% $\rho(\tilde{G})_r<\infty$, only if $\mu_\Delta(M_0)<1$
% \end{prop}
% \begin{proof}
% From definition \ref{robust_specr.def}, if $\rho(\tilde{G})_r<\infty$, $\mu_{MS}(G_\Delta) = \rho(\tilde{G}_\Delta)\leq\rho(\tilde{G})_r<\infty$. Therefore, the feedback interconnection of $G_\Delta$ and $\bar{\Delta}$, i.e. $S(G_\Delta,\bar{\Delta})$ is MS stable for $\bar{\Delta}=\mathbf{0}$ ($\sigma^2 =0$). It holds for all $\Delta\in \mathcal{B}_\Delta^{LTI}$. Since $S(G_\Delta,\mathbf{0})=S(\Delta,M_0)$, $M_0$ is stable for all $\Delta\in \mathcal{B}_\Delta^{LTI}$. Recall definition of $\mu$, $\mu_\Delta(M_0)<1$.
% \end{proof}



% \begin{defn}
% $\mu_{\Delta_{mixed}}= \frac{1}{\inf\{\max\{\|\Delta\|_\infty,\sigma^2\},S(S(\Delta,M),\bar{\Delta})\text{ is not MS stable}\}}$
% \end{defn}

% \begin{remark}
% $\mu_{\Delta}(M_0)<1$ ensures that the nominal system is robustly MS stable within any $\Delta$ varying in $\|\Delta\|<1$. Given this satisfied, $\rho(\tilde{G})_r<1$ further requires the system be MS stable given any $\Delta$ LTI in $\|\Delta\|<1$ and $\bar{\Delta}$ with variance less than $1$. 
% \end{remark}



On the other hand, Theorem~\ref{thm:robMSnorm}
allows us to simply compute for a fixed $\theta$
$$
\sup_{\Delta\in\mathcal{B}_\Delta^{\mathrm{LTI}}}\|\theta G_\Delta\theta^{-1}\|^2_{MS}
$$
By minimizing over weight $\theta>0$, we will obtain
$$
\inf_{\theta>0}\sup_{\Delta\in\mathcal{B}_\Delta^{\mathrm{LTI}}}\|\theta G_\Delta\theta^{-1}\|^2_{MS}
$$

Note that 
\begin{equation*}
\rho(\tilde{G})_r=\sup_{\Delta\in\mathcal{B}_\Delta^{\mathrm{LTI}}}\inf_{\theta>0}\|\theta G_\Delta\theta^{-1}\|^2_{MS}\leq \inf_{\theta>0}\sup_{\Delta\in\mathcal{B}_\Delta^{\mathrm{LTI}}}\|\theta G_\Delta\theta^{-1}\|^2_{MS}\stackrel{\triangle}{=}\bar{\rho}(\tilde{G})_r
\end{equation*}
always. 
So what we are computing is, in general, an upper bound to $\rho_r(\tilde{G})$.
% We believe the source of this conservatism is analogous to the traditional conservatism introduced by the $\mu$ upper bound. We leave to future research this investigation and also the classification of possible setting, like $\mu$-simple, where the upper bound may in fact be exact.  
We leave to future research this investigation into reducing conservatism. We have the main result of this section.
\begin{thm}\label{thm:upperbound}
System $M$ has $\mu_{\bm{\Delta},\bar{\Delta}}(M)<1$ if there exist 
positive definite Hermitian matrices $X_i(\omega)\in \mathbb{X}$ and real transfer function $w_i(\omega)>0$ 
$i=1,\hdots,n_v$ and real positive diagonal scaling $\beta$  such that 
\begin{subequations}
\begin{align}
M_i(\omega)
\left[
\begin{array}{cc}
    \tilde{X}_i(\omega) & 0 \\
    0 &\beta
\end{array}\right]
[M_i(\omega)]^\hermconj & <
\begin{bmatrix}
    \tilde{X}_i(\omega) & 0 \\
    0 & w_i(\omega)
\end{bmatrix}\label{eqn:mu_freq_lmi1} \\
\int_0^{2\pi}w_i(\omega)\frac{d\omega}{2\pi} & \leq \beta_i
\end{align}
\end{subequations}
for $i=1,\hdots, n_v$.
\end{thm}
% The above is a convex feasibility problem for fixed $\gamma$. In particular, if for $\gamma=1$ the problem is feasible, then we have robust MS stability. 


\begin{proof}
First of all, LMI (\ref{eqn:mu_freq_lmi1}) implies, $M_{qp}(\omega)\tilde{X}_i(\omega)M_{qp}^*(\omega)<\tilde{X}_i(\omega)$, which ensures $\mu_{\bm{\Delta}}(M_{qp}) < 1$.
To include the diagonal weights \(\theta\), we let
\begin{align*}
    {y^{'}}={\theta}{y},\ {v^{'}}={\theta}{v}.
\end{align*}
Let \(M^\theta\) denote the re-weighted transfer function matrix by \(\theta\):
\begin{equation}
M^\theta = \left[
    \begin{array}{cc}
        M_{qp}&M_{qv}\theta^{-1}\\
        \theta M_{yp} &\theta M_{yv}\theta^{-1}\\
    \end{array}\right].
\end{equation}
We apply Theorem \ref{thm:robMSnorm} on the scaled mapping. For the \(i\)-th row, it has the frequency domain mapping matrix, i,e. $[q,y_i^{'}]^T= M_i^\theta [p,v^{'}]^T$
\begin{equation}\label{eachoutputM}
M_i^\theta = \left[
    \begin{array}{cc}
        M_{qp} & M_{qv}\theta^{-1}\\
        \theta_i M_{yp_i} &\theta_i M_{yv_i}\theta^{-1}\\
    \end{array}\right];
    M_i=
    \left[
    \begin{array}{cc}
        M_{qp}&M_{qv}\\
        M_{yp_i} &M_{yv_i}\\
    \end{array}\right]
\end{equation}

Substitute (\ref{eachoutputM}) in (\ref{freqbound}) will give us
\begin{equation}\label{freqbound_scale}
    [M_i(\omega)]^\hermconj
    \left[
    \begin{array}{cc}
    X_i(\omega) &  \\
     & \theta_i^2
    \end{array}\right]
    M_i(\omega)
<\left[
\begin{array}{cc}
    X_i(\omega) &  \\
     & y_i(\omega)\theta^2
\end{array}\right]
\end{equation}
% Note here that, for each output channel, we select a new multiplier $X_i(\omega)$, because we want to find the $\mathcal{H}_2$ norm bound, i.e. the worst case, for each channel. There's no need to restrict that the $\Delta$ hold the same.

LMI (\ref{intbyfreq}) gives us that for a fixed $\theta$, the robust MS norm of the scaled system is
$$
\|\theta G \theta^{-1}\|_{MS,r}^2=\max_i{ \int_0^{2\pi}y_i(\omega)\frac{d\omega}{2\pi}}
$$
Optimized over $\theta$, $\bar{\rho}(\tilde{G})_r$ is given by
\begin{equation}
    \bar{\rho}_r(\tilde{G})=\inf_{\theta}\|\theta G \theta^{-1}\|_{MS,r}^2=\inf_{\theta}\max_i{ \int_0^{2\pi}y_i(\omega)\frac{d\omega}{2\pi}}
\end{equation}
Therefore, $\bar{\rho}_r(\tilde{G})<1$ if
\begin{subequations}
\begin{align}
    [M_i(\omega)]^\hermconj
    \left[
    \begin{array}{cc}
    X_i(\omega) &  \\
     & \theta_i^2
    \end{array}\right]
    M_i(\omega)
& <\left[
\begin{array}{cc}
    X_i(\omega) &  \\
     & y_i(\omega)\theta^2   
\end{array}\right] \\
\int_0^{2\pi}y_i(\omega)\frac{d\omega}{2\pi} & \leq 1 \label{eqn:freqsum}
\end{align}
\end{subequations}
for $i=1,\ldots,n_v$.


However, this optimization is non-convex because of  the multiple products of $y_i(\omega)$ and $\theta^2$. By some LMI transformations, we derive an equivalent problem expressed in a quasi-convex form. By Schur complement, the LMI (\ref{freqbound_scale}) is equivalent to,
\begin{equation*}
    M_i
    \left[
    \begin{array}{cc}
        X_i(\omega)^{-1} & 0 \\
        0 & y_i(\omega)^{-1} \theta^{-2}
    \end{array}\right]
    M_i^*<
    \left[
    \begin{array}{cc}
        X_i(\omega)^{-1} & 0 \\
        0 & \theta_i^{-2}
    \end{array}\right] 
\end{equation*}
Multiply by the  scalar $y(\omega)>0$ and letting  $\tilde{X}_i(\omega)=X_i(\omega)^{-1}y_i(\omega)$. Since $y_i(\omega)>0$ is a scalar, $\tilde{X}_i(\omega)\in \mathbb{X}$.
\begin{equation}
    M_i(\omega)
    \left[
    \begin{array}{cc}
        \tilde{X}_i(\omega) & 0 \\
        0 & \theta^{-2}
    \end{array}\right]
    M_i^*(\omega)<
    \left[
    \begin{array}{cc}
        \tilde{X}_i(\omega) & 0 \\
        0 & y_i(\omega)\theta_i^{-2}
    \end{array}\right]
\end{equation}
Let $\theta_i^{-2}=\beta_i$, $\beta=\mathrm{diag}(\beta_i)$ and $y_i(\omega)\theta_i^{-2}=w_i(\omega)$. \eqref{eqn:freqsum} is transformed into 
\begin{equation}
   \,\beta_i\,\geq \int_0^{2\pi}w_i(\omega)\frac{d\omega}{2\pi}
\end{equation}
\end{proof}



% \section{Robust $\mathcal{H}_2$ Performance}
% We conclude our derivations by presenting a novel result on the computation of the Robust ${\cal H}_2$ performance. 

% The key technical innovation is to characterize the ${\cal H}_2$ as a spectral radius condition and the robust  ${\cal H}_2$  as a robust  spectral radius problem. 


% We will show that this requires some plant augmentation, and this may be one of the reasons the computations appear to be quite effective. 
% As we have mentioned, available methods are limited by quite large conservatism, as showed in the examples section. 
% \begin{defn}\label{robH2.def}
% Given a discrete time LTI system $M$ defined in (\ref{Discrete_statespace_Mix}), i.e. the mapping transfer function defined in (\ref{freq_domain_mapping}). Assume the interconnection $G_\Delta=S(\Delta,M)$ is well defined and robustly stable with all $\Delta \in \mathcal{B}_\Delta^{LTI}$.
% Then  the system $M$ is said to have  robust ${\cal H}_2$ performance $\|G\|_{2,r}^2$ if 
% \begin{equation*}
%     \|G\|_{2,r}\stackrel{\triangle}{=}\sup_{\Delta \in \mathcal{B}_\Delta^{LTI}}\|G_{\Delta}\|_2 < \infty
% \end{equation*}
% \end{defn}



% \begin{thm}\label{thm:robustH_2} Consider the following augmented system
% Let 
% \begin{equation*}
% \overline{M}=
% \left[\begin{array}{cc}
%         \overline{M}_{11}&\overline{M}_{12}\\
%         \overline{M}_{21}&\overline{M}_{22}\\
%     \end{array}\right]
% \end{equation*}
% where,
% \begin{equation*}
% \begin{split}
%     &\overline{M}_{11}=M_{qp};\ 
%     \overline{M}_{12}= 
%     \left[
%     \begin{array}{cc}
%         \mathbf{0}_{n_p\times n_y} & M_{qv} \\
%     \end{array}\right];\\
%     &\overline{M}_{21}= 
%     \left[
%     \begin{array}{c}
%         M_{yp}\\
%         \mathbf{0}_{n_v\times n_p}\\
%     \end{array}\right];\ 
%         \overline{M}_{22}= 
%     \left[
%     \begin{array}{cc}
%         \mathbf{0}_{n_y\times n_y} & M_{22} \\
%         \mathbf{1}_{n_v\times n_y} & \mathbf{0}_{n_v\times n_v} \\
%     \end{array}\right];
% \end{split}
% \end{equation*}
% For any $\Delta$ let  $G_\Delta=S(\Delta,M)$ be the transfer function matrix between $v$ and $y$. Analogously Let  $\overline{G}_\Delta=S(\Delta,\overline{M})$ is given by
% \begin{equation}
%     \left[\begin{array}{c}
%         y  \\
%         \bar{y} 
%     \end{array}\right]=\overline{G}(\Delta)
%     \left[\begin{array}{c}
%         \bar{v}  \\
%          v
%     \end{array}\right]=
%     \left[\begin{array}{cc}
%         0& G(\Delta)  \\
%         \mathbf{1}_{n_v\times n_y}&0\\
%     \end{array}\right]
%     \left[\begin{array}{c}
%         \bar{v}  \\
%          v
%     \end{array}\right]
% \end{equation}
% Then
% $\rho(\hat{\overline{G_\Delta}})=\|G_\Delta\|_{2}$
% \end{thm}
% \begin{proof}

% % \begin{figure}[h]
% %     \centering
% %     \includegraphics[scale=0.35]{figures/RMSSfigure/H_2system_alt.png}
% %     \caption{The system construction used to compute the robust $\mathcal{H}_2$ norm of the given system $M$ with uncertainty $\Delta$. $\bar{y}$ are virtual outputs with the same dimension as $v$ and $\bar{v}$ are virtual inputs with the same dimensions as $y$.$\Delta_y$ and $\Delta_v$ are stochastic blocks ruled in section 2.}
% %     \label{fig:solveH_2norm}
% % \end{figure}



% Let  matrix of the $\mathcal{H}_2$ norm square  of each element of the augmented system  $\overline{G}_\Delta$ be given by 

% $$
% \hat{\overline{G}}_\Delta=
% \left[\begin{array}{cc}
%         & \tilde{G}_\Delta  \\
%         \mathbf{1}_{n_v\times n_y}&\\
%     \end{array}\right]
% $$
% compute $\rho(\hat{\overline{G}}_\Delta)$ from the determinant formula.  
% $$
% \mathrm{det}\left(
% \left[
% \begin{array}{cc}
%       \lambda I_{n_y} & -H  \\
%         -\mathbf{1}_{n_v\times n_y}&\lambda I_{n_v}\\
%     \end{array}\right]\right)=0
% $$
% From the block determinant formula, we have that 
% $$\mathrm{det}(\lambda^2 I_{n_y} -H \cdot \mathbf{1}_{n_v\times n_y})
% =0$$ 
% which is equivalent, using the classical property of the determinant, to 
% $$
% \lambda^2= \mathbf{1}_{n_y}^T H\mathbf{1}_{n_v}=\sum_{i,j}{H_{ij}}=\|G_\Delta\|_2^2
% $$. 
% This means that the $\rho(\hat{\overline{G}}_\Delta)$
%  of the augmented system is just the $\mathcal{H}_2$ norm of the original system $G_\Delta$.
% \end{proof}

% \begin{corollary}\label{thm:robustH_22} 
% System $M$ has a robust $\|G\|_{2,r}\leq \gamma$
% if the following set of LMI's is feasible. For $i=1,\ldots,n_v+n_y$ 
% \begin{equation}\label{LTIdualFReqbound}
%     \overline{M}_i
%     \left[
%     \begin{array}{cc}
%         \tilde{X}_i(\omega) & 0 \\
%         0 &\beta
%     \end{array}\right]
%   \overline{M}_i^*<
%     \left[
%     \begin{array}{cc}
%         \tilde{X}_i(\omega) & 0 \\
%         0 & w_i(\omega)
%     \end{array}\right]
% \end{equation}
% and
% \begin{equation}\label{freqint_bound}
%     \gamma\beta_i\geq \int_0^{2\pi}w_i(\omega)\frac{d\omega}{2\pi}
% \end{equation}


% \end{corollary}

% \begin{proof}
% Apply Theorem 3 and use the result of Theorem 4. 
% \end{proof}




% When the system is stable with every multiplicative gain variance to be 1, the spectral radius of the upper matrix is then 1.



% Given a mapping $M$ from $[p,v]^T$ to $[q,y]^T$, the mapping should be augmented as below with $\bar{y}$ and $\bar{v}$ added.
% \begin{equation}
% \left[
%     \begin{array}{c}
%         {q}\\
%         {y}\\
%         {\bar{y}}
%     \end{array}\right]
% =
% \left[\begin{array}{ccc}
%         M_{qp}&\mathbf{0} &M_{qv}\\
%         M_{yp}& \mathbf{0}&M_{22}\\
%         \mathbf{0}& \mathbf{1}_{n_v\times n_y} &\mathbf{0}\\
%     \end{array}\right]
% \left[
%     \begin{array}{c}
%         {p}\\
%         {\bar{v}} \\
%         {v}
%     \end{array}\right]
% \end{equation}

% Name the new mapping as $\overline{M}$, and we can apply optimization \ref{freqoptformuMS} to $\overline{M}$ to solve the robust $\mathcal{H}_2$ norm bound for the system $M$.
% Due to the equivalence $\mu_{MS}(\overline{M})=\|T_{yv}(M,\Delta)\|_2^2$ when the uncertainty $\Delta$ is LTI and the sufficiency and necessity of $\mu_{MS}$, this solution is necessary and sufficient $\mathcal{H}_2$ norm bound of the original system.





\section{Numerical Examples}
\subsection{System configuration}
We apply the robust MS stability condition to the robustness analysis of the following example. We consider a classical inverted pendulum robot. We assume that the sensor can ideally measure somethe system's outputs. However, we are interested in analyzing the effects of intermittent attention. This can model a user paying discontinuous attention to the device or that the sensor is connected to the controller over unreliable network.
We want to study how the robustness to unmodeled dynamics is affected by the unreliable networks and vice-versa.  


\begin{figure}[h]
    \centering
    \includegraphics[scale=0.45]{figures/RMSSfigure/Plant1.png}
    \caption[1-D inverted pendulum model]{$m_c$ is the mass of the cart. Assume the pendulum is light and has a concentrated mass $m_p$ at its top. The driving force on the cart $u$ is the control input to the system.}
    \label{fig:pendulumplant}
\end{figure}

We assume that the stochastic communication intermittency occurs in each communication channel from sensors to controller. 
The sensors measure the horizontal velocity of cart $\dot{s}$ and the bias angle $\theta$ from vertical of the pendulum. The controller is causal and gives out the driving force $u$ on cart to maintain the stability of the system based on the signals of measurements.  


Deterministic uncertainties may arise from multiple sources, such as gain fading, unmodeled dynamics, and model parameter errors. We aim to assess the overall tolerance to these uncertainties. So we choose an entrance to the $\Delta$ block, which describes the disk margin of the open-loop interconnection between the plant and controller. It is shown in section C.

% {\color{red} gain and phase margins (are not imprecise) are a measure of the uncertainty of the system! More importantly, we are using disk uncertainty, which is a generalization of classical gain and phase margins}
Equations of motion in continuous time are given as~\eqref{eqn:EoMPendulumCT}, adapted from \cite{leong2016understanding}.
\begin{subequations}\label{eqn:EoMPendulumCT}
\begin{align}
(m_c+m_p)\ddot{s}+ m_p l (\ddot{\theta}-\dot{\theta}^2 \sin{\theta}) & = u  \\
m_p (\ddot{s}\cos{\theta}+l\ddot{\theta}-g \sin{\theta})=0
\end{align}
\end{subequations}

Linearize the dynamic model about
$$
\left[
\begin{array}{ccc}
    \dot{s} & \theta& \dot{\theta}\\
\end{array}\right]^T=
\left[
\begin{array}{ccc}
    0 & 0& 0\\
\end{array}\right]^T
$$
Discretize it to obtain the state-space expression in discrete time.
% $$
% x^+=A x + B u;\ y=Cx
% $$
% {\color{red} then next section is a bit problematic. 1) we have not been focused on design, so why do we focus on it now? The controller should be given, and motivated, and if justified it need to be explain correctly.}  
\subsection{Controller Design}
% {\color{red} the above sentence is illogical, if there were a design method it would be automatically based on an analysis method. Moreover, why don't we use the D-K design method for mu?}$\surd$


It is outside the scope of the paper to address the optimal controller design. Herein, we evaluate the limitations of an existing controller. Such a controller has the structure shown in figure (\ref{fig:CLblk}.a), which is motivated by \cite{Jeff2005Packet}, to effectively deal with dropouts, but otherwise is an $\mathcal{H}_\infty$ controller based on the mean system shown in figure (\ref{fig:CLblk}.c). Need more details on how the $\mathcal{H}_\infty$ controller is designed, see appendix. 

\begin{figure}[htbp]
    \centering
    \includegraphics[scale=0.6]{figures/RMSSfigure/ClosedloopBDG.PNG}
    \caption[Block diagram transformation]{In (a), $P$ is the plant. $K$ is the output feedback controller and $L$ is the receiver. For example, $L=1$ is equivalent to the zero-order hold, i.e., the output measurement from the last time step replaces the signal if it has dropped. $\xi=\mathrm{diag}(\xi_1,\xi_2)$, $\xi_1$ and $\xi_2$ are IID stochastic numbers which take value from $\{0,1\}$ at each time step. By a sequence of block diagram transformations, we obtain (b). In (c), $\hat{K} = K(I-\tilde{L})^{-1}$, $\hat{L} = L(I-\tilde{L})^{-1}$. By adjusting $\hat{K}_e$ and $\hat{L}_e$ w.r.t. $e$, we can always ensure the mean system of (d) is (c). In (d), $\bar{\Delta} =\mathrm{diag}(\delta_{s_1},\delta_{s_2})$, $\delta_{s_i}$ are IID mean 0, variance $e/(1-e)$, with $e$ probability to take $-1$ and $1-e$ probability to take $e/(1-e)$.}
    \label{fig:CLblk}
\end{figure}


We implement the controller on the plant in Matlab Simulink, and test the system's response subject to an impulse on the cart's velocity, assume no packet drop and system uncertainty, shown in figure (\ref{fig:impulse_resp}). 

In figure (\ref{fig:CLblk}.c), the mean system has an equivalent open loop transfer function of $\hat{K}(I+z^{-1}\hat{L})^{-1}P$. From the controller we've designed, the open-loop transfer function has properties shown in Table~\ref{tab:margin}. The margins are sufficient. We can conclude that this controller is robust against model uncertainty. 
\begin{table}[h]
    \caption{Properties of the open loop system}\label{tab:margin}
    \centering
    \begin{tabular}{ccc}
    \hline
        Margin  & Value \\
    \hline
        Gain margin & $[0.5189,1.9271]$\\
        Phase margin & $[-35.15,35.15]\deg$\\
        Disk margin & $ 0.6335$\\
        $\mathcal{H}_\infty$ norm & 1.6200 \\
        \hline
    \end{tabular}
\end{table}

\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.7]{figures/RMSSfigure/states_plot.png}
    \caption[Cart-pole impulse response]{The impulse response of a initial cart velocity $\dot{s}=0.1$ without model perturbation and packet drops. The system recovers zero state in about 10s.}
    \label{fig:impulse_resp}
\end{figure}


\subsection{Robust Mean Square stability analysis}




We now introduce deterministic and stochastic uncertainty into this closed-loop system; see Figure (\ref{fig:CLRMSplant}). $\bar{\Delta}$ is a stochastic block which determined only by the packet drop probability $e$. $\Delta$ is a norm-bounded linear deterministic $l_2\rightarrow l_2$ mapping, and its maximal size captures the open-loop disk margin of interconnection of plant and controller. % Its disk margin is $0.6335$. Its phase margin is $[-35.15\deg,35.15\deg]$.

\begin{figure}[t]
    \centering
    \includegraphics[scale=0.6]{figures/RMSSfigure/completeCLsys.PNG}
    \caption[Nominal model versus robust analysis model]{(a) is the mean system. (b) is the complete system with stochastic and deterministic uncertainties. $\bar{\Delta} =\mathrm{diag}(\delta_{s_1},\delta_{s_2})$,$\delta_{s_i}$ are IID mean 0, variance $e/(1-e)$, with $e$ probability to take $-1$ and $1-e$ probability to take $e/(1-e)$. On the other side, $\|\Delta\|_\infty<\eta$.}
    \label{fig:CLRMSplant}
\end{figure}

Write the system in the expression of equation (\ref{Discrete_statespace_Mix}). And then compute the $M(e^{j\omega})$ by (\ref{eqn:constrM}) and (\ref{constrM_i}). Apply Theorem 3. To implement it in convex tools, we can only have finite constraints. Therefore, we uniformly sample $N=100$ points from $[0,2\pi)$ and approximate the integral LMIs by a finite sum. We get $2N$ different constraints and 2 sum constraints instead of the integral constraint in Theorem \ref{thm:upperbound}.
\begin{subequations}
\begin{align}
M_i(e^{j\omega(k)})
\left[
\begin{array}{cc}
    \tilde{X}_i(\omega(k)) & 0 \\
    0 &\beta
\end{array}\right]
M_i^*(e^{j\omega(k)}) & < \left[
\begin{array}{cc}
    \tilde{X}_i(\omega(k)) & 0 \\
    0 & w_i(\omega(k))
\end{array}\right],\\ 
\frac{1}{N} \sum_{k=1}^{N}w_i(\omega(k)) \leq \gamma \beta_i, &  \quad i=1,2; \\
\omega(k) =\frac{2k\pi}{N}+\alpha,& \quad k\in \mathcal{H}_N.
\end{align}
\end{subequations}


Use these LMIs, $\gamma$ gives us the $\bar{\rho}_r(\tilde{G})$ of different deterministic size $\eta$, i.e. the inverse of maximum allowed variance in $\delta_{s_i}$. Since $var(\delta_{s_i}) =\frac{e}{1-e}$.
$$
\frac{1}{\gamma} =\frac{e}{1-e}\Leftrightarrow e=\frac{1}{\gamma+1}
$$
We can plot the largest allowed probability of packet drop against the given uncertainty $\eta$ in controller gain. 
\begin{figure}[h]
    \centering
    \includegraphics[scale=0.5]{figures/RMSSfigure/eta_e_plot.png}
    \caption[Robustness against both stochastic process and model uncertainty]{The relationship between the maximum drop probability against radius of disk uncertainty.}
    \label{fig:eta_e}
\end{figure}

Basically, the nominal system with \(0\) drop-out probability achieves the largest disc robustness. As the system is subject to increasing drop-out, its robustness to deterministic disc uncertainty diminishes. This figure numerically demonstrates the interplay between the two different type of uncertainty. Finally, for a maximum dropout probability of $44\%$, the system is fragile to deterministic input uncertainty. 

% It accords to our intuition that the relationship between $\eta$ and $e$ is trade-off. In other words, if we ensure less uncertainty in the controller $K$, then we can allow more packet drop in our communication. {\color{red} the conclusion needs to be precise and insightful. Basically. the largest disc robustness in for the nominal system (which is also our zero stochastic uncertainty) system.  As the system is subject to stochastic dropouts, its robustness to  deterministic disc uncertainty is diminished. This shows the interplay between the two different type  of uncertainty. Finally for a maximum  dropout probability of $~45\%$ the system is fragile to deterministic input uncertainty. } From figure (\ref{fig:eta_e}), we find that if the controller is perfect ($\eta=0$), then we can allow at most $44\%$ packet drop in each communication channel, which shows that, this CL system is robust in terms of stochastic uncertainty. And if the communications are perfect ($e=0$), then we have $0.61$ disk margin in this system, which is also satisfactory.


\section{Summary}
In this chapter, we formulated the robust MS stability problem in the presence of deterministic LTI perturbations. We extended the robust stability notion of $\mu$ to include both deterministic and stochastic uncertainties and provided an efficient computational sufficient condition that guarantees robust MSS. To our knowledge, this is the first time $\mu$ has been extended to deterministic and stochastic uncertainties. 

We used the inverted pendulum example, where the sensors are subject to communication packet drops, and examine the trade-offs between the size of sensor intermittency uncertainties and the disk margin. 







